/**
 * MiMC hash function used in the contract
 */

const MiMC5Sponge = (ins: bigint[], k: bigint): bigint => {
  const p: bigint =
    21888242871839275222246405745257275088548364400416034343698204186575808495617n;
  let lastR: bigint = 0n;
  let lastL: bigint = 0n;

  const c: bigint[] = [
    0n,
    106817110799769433093218245423871844717059833683452559466196112354004638572498n,
    84255324824758778243920689261768054268226603835992097862981564101503393631449n,
    37197502047088319755447032783014359157651485250083660539303816043345813047711n,
    32663483869350569457441108253326666697207255573603065306759678212807797608657n,
    77949981596831327030843275836056163759930345566858706468497257143337701635082n,
    48008708032837997889055358250659021109935598563956572847846081057442579963924n,
    78151704570921477873127137133941054666810713605170453966535534917554089394478n,
    15348534912154501649990460011781534533170346398475899082484059257946895286096n,
    18970395545469280351107608050419345078001347302157351944399526916015227829188n,
    22679761981509195336998531649239086318015246397079256509235559663628925312795n,
    35586271636152612797214292674565595612070971867022205208695270681460796375740n,
    61221530312118325840150771247903849929566155139377953764663614207837924324144n,
    103286633200621620507248023416367379780460418287112807675789453707427940506967n,
    24475696250073834857397447409849709457582056151188669376174099629191337376327n,
    27312551529750852384898501883128611829852368515804657815211432516406859346379n,
    23581290894526212408203595224199706484202370309378983986329426965760228181458n,
    103691616112549261464497394142126612171833073254702145237603537411191373654519n,
    110981869723234407281789291191816098797715721518483276773393741342066687223795n,
    9200945872320684290134711189807383509743942292509394373376250231750977697727n,
  ];

  for (let i = 0; i < ins.length; i++) {
    lastL = (lastL + ins[i]) % p;

    for (let j = 0; j < 20; j++) {
      let mask = (lastR + k + c[j]) % p;
      mask = mask ** 5n % p;

      const temp = lastR;
      lastR = (lastL + mask) % p;
      lastL = temp;
    }
  }

  return lastL;
};

export default MiMC5Sponge;
